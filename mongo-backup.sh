#!/usr/bin/env bash

MONGO_HOST=${MONGO_HOST:-"127.0.0.1"}
MONGO_PORT=${MONGO_PORT:-"27017"}
BACKUPS_DIR=${BACKUPS_DIR:-"backups"}
MONGODUMP_PATH=${MONGODUMP_PATH:-"mongodump"}

TIMESTAMP=`date +%F-%H%M`
BACKUP_NAME="dump-$TIMESTAMP"
$MONGODUMP_PATH -h $MONGO_HOST:$MONGO_PORT

mkdir -p $BACKUPS_DIR
mv dump $BACKUP_NAME
tar -zcvf $BACKUPS_DIR/$BACKUP_NAME.tgz $BACKUP_NAME
rm -rf $BACKUP_NAME